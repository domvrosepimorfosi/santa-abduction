<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E.L.F. Squad: Operation Leftover Spirit</title>
    <style>
        /* --- GLOBAL LAYOUT --- */
        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #smartboard-container {
            background-color: #34495e;
            width: 98vw;
            height: 96vh;
            border: 8px solid #c0392b;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            position: relative;
            box-sizing: border-box;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        h1, h2 {
            text-align: center;
            color: #f1c40f;
            text-shadow: 2px 2px 4px #000;
            margin: 0 0 10px 0;
            font-size: 1.6rem;
        }
        p { font-size: 1.1rem; margin: 5px 0; line-height: 1.4; }

        /* --- TIMER --- */
        #mission-timer {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #000;
            color: #e74c3c;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.5rem;
            padding: 5px 15px;
            border: 2px solid #c0392b;
            border-radius: 5px;
            z-index: 100;
            font-weight: bold;
        }

        /* --- LAYOUT UTILITIES --- */
        .game-section { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
        #section-home { display: flex; }

        .split-layout { display: flex; flex-direction: row; align-items: center; justify-content: center; width: 100%; height: 100%; gap: 20px; }
        .split-left { flex: 3; display: flex; justify-content: center; align-items: center; height: 100%; max-width: 65%; }
        .split-right { flex: 2; display: flex; flex-direction: column; justify-content: center; height: 100%; max-width: 35%; }

        /* --- IMAGES --- */
        .dashboard-wrapper { position: relative; width: 100%; display: flex; justify-content: center; }
        .dashboard-bg-image { width: 100%; height: auto; max-height: 85vh; object-fit: contain; border-radius: 10px; border: 4px solid #2c3e50; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .scene-image { max-height: 75vh; max-width: 100%; width: auto; border-radius: 8px; border: 3px solid #2c3e50; box-shadow: 0 5px 15px rgba(0,0,0,0.3); margin-bottom: 10px; }
        .split-layout .scene-image { max-height: 85vh; width: 100%; object-fit: contain; margin-bottom: 0; }

        /* --- OVERLAYS --- */
        .logo-overlay { position: absolute; top: 15px; right: 20px; width: 80px; z-index: 50; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5)); transition: opacity 0.3s ease; }
        .image-btn-hotspot { position: absolute; cursor: pointer; z-index: 10; }
        .image-btn-hotspot:hover { background-color: rgba(255, 255, 255, 0.2); border-radius: 15px; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
        
        /* Updated Hotspot Positions for 4 Buttons (Mental grid since image is 3 buttons)
           We will reuse the 3 buttons but map the flow differently */
        #btn-spot-suspects { top: 42%; left: 12%; width: 21%; height: 30%; }
        #btn-spot-clues { top: 42%; left: 39.5%; width: 21%; height: 30%; }
        #btn-spot-solve { top: 42%; left: 67%; width: 21%; height: 30%; }

        /* --- CONTENT CONTAINERS --- */
        .briefing-box { background-color: rgba(0, 0, 0, 0.4); border-left: 6px solid #f1c40f; padding: 20px; border-radius: 8px; font-size: 1.1rem; color: #fff; }
        .profiles-row { display: flex; justify-content: center; gap: 15px; width: 100%; margin-bottom: 15px; }
        .profiles-stack { display: flex; flex-direction: column; gap: 10px; width: 100%; overflow-y: auto; max-height: 70vh; padding-right: 5px; }
        
        .profile-card { background-color: #ecf0f1; color: #2c3e50; padding: 12px; border-radius: 10px; box-shadow: 3px 3px 8px rgba(0,0,0,0.2); flex: 1; text-align: center; font-size: 0.95rem; }
        .profile-card h3 { color: #c0392b; font-size: 1.1rem; margin-top: 0; margin-bottom: 5px;}

        /* --- DECRYPTOR --- */
        .scramble-area { background: #34495e; padding: 10px; border-radius: 5px; margin-top: 5px; }
        .word-bank { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-bottom: 5px; }
        .scramble-word { background: #f1c40f; color: #2c3e50; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.9rem; font-weight: bold; }
        .scramble-word:hover { transform: scale(1.1); }
        .answer-box { min-height: 30px; background: #fff; border: 2px dashed #95a5a6; padding: 5px; color: #2c3e50; font-weight: bold; display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
        .decrypted-text { color: #27ae60; font-weight: bold; font-style: italic; }

        /* --- INTERROGATION ROOM STYLES --- */
        .witness-card {
            background-color: #2980b9;
            color: white;
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 4px solid transparent;
        }
        .witness-card:hover { transform: scale(1.02); }
        .witness-card.selected { border-color: #f1c40f; background-color: #3498db; }
        .witness-card.correct { border-color: #2ecc71; background-color: #27ae60; }
        .witness-card.wrong { border-color: #c0392b; background-color: #c0392b; opacity: 0.5; }
        .elf-avatar { font-size: 2rem; float: left; margin-right: 15px; }

        /* --- BUTTONS --- */
        .nav-container { margin-top: auto; margin-bottom: 10px; display: flex; gap: 15px; justify-content: center; width: 100%; }
        .btn { padding: 10px 25px; font-size: 1.1rem; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-green { background-color: #2ecc71; color: white; }
        .btn-red { background-color: #e74c3c; color: white; }
        .btn-blue { background-color: #3498db; color: white; }
        .btn-back { background-color: #95a5a6; color: white; }
        .btn-disabled { background-color: #7f8c8d; cursor: not-allowed; opacity: 0.7; }

        .solve-options { display: flex; gap: 20px; justify-content: center; width: 100%; margin-top: 20px;}
        .solve-btn { padding: 20px; background: #ecf0f1; color: #2c3e50; border: 4px solid #c0392b; border-radius: 12px; width: 180px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .solve-btn:hover { background: #f1c40f; transform: scale(1.05); }

        /* --- QUIZ GRID --- */
        #quiz-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; width: 100%; overflow-y: auto; max-height: 65vh; padding: 10px; }
        .quiz-card { background-color: #ecf0f1; color: #2c3e50; padding: 10px; border-radius: 10px; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); flex: 1 1 200px; max-width: 300px; text-align: center; }
        .quiz-word { font-size: 1.2rem; font-weight: bold; color: #c0392b; text-transform: uppercase; margin-bottom: 5px;}
        .quiz-options { display: flex; flex-direction: column; gap: 5px; }
        .quiz-btn { padding: 8px; border: 2px solid #34495e; background: white; border-radius: 5px; cursor: pointer; font-weight: bold;}
        .quiz-btn:hover { background: #ddd; }
        .quiz-btn.correct { background: #2ecc71; color: white; border-color: #27ae60; }
        .quiz-btn.wrong { background: #e74c3c; color: white; border-color: #c0392b; opacity: 0.6; }

        .footer { margin-top: auto; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); width: 100%; text-align: center; font-size: 0.8rem; color: rgba(255,255,255,0.6); }
    </style>
</head>
<body onload="initGame()">

<div id="smartboard-container">
    <div id="mission-timer">15:00</div>
    <img id="app-logo" src="logo.png" alt="School Logo" class="logo-overlay">

    <div id="section-home" class="game-section">
        <div class="split-layout">
            <div class="split-left">
                <div class="dashboard-wrapper">
                    <img src="image_0.png" alt="Main Dashboard UI" class="dashboard-bg-image">
                    <a id="btn-spot-suspects" class="image-btn-hotspot" onclick="showSection('section-suspects')" title="See Suspects"></a>
                    <a id="btn-spot-clues" class="image-btn-hotspot" onclick="showSection('section-clues-wide')" title="See Clues"></a>
                    <a id="btn-spot-solve" class="image-btn-hotspot" onclick="alert('Access Denied: You must interview witnesses first!');" title="Locked"></a>
                </div>
            </div>
            <div class="split-right">
                <div class="briefing-box">
                    <h2 style="margin-top: 0;">üéÖ MISSION BRIEFING</h2>
                    <p>Halloween is over, but the <strong>Leftover Spirits</strong> refused to go home!</p>
                    <p><strong>Santa is missing</strong>. One of the spirits took him.</p>
                    <p><strong>New Protocol:</strong> You must check the Scene, Train vocabulary, Decrypt clues, and <strong>Interrogate Witnesses</strong> before solving.</p>
                </div>
            </div>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-suspects" class="game-section">
        <div class="split-layout">
            <div class="split-left">
                <img src="image_1.png" alt="Suspect Lineup" class="scene-image"> 
            </div>
            <div class="split-right">
                <h2 style="margin-bottom: 10px;">SUSPECT PROFILES</h2>
                <div class="profiles-stack">
                    <div class="profile-card">
                        <h3>The Witch</h3>
                        <p><strong>Looks:</strong> Green skin. Messy.</p>
                        <p><strong>Habits:</strong> Cooks big pots of soup.</p>
                    </div>
                    <div class="profile-card">
                        <h3>The Skeleton</h3>
                        <p><strong>Looks:</strong> Only bones.</p>
                        <p><strong>Habits:</strong> Tidy. Hates liquids.</p>
                    </div>
                    <div class="profile-card">
                        <h3>The Ghost</h3>
                        <p><strong>Looks:</strong> Transparent.</p>
                        <p><strong>Habits:</strong> Floats. Hates lights.</p>
                    </div>
                </div>
                <div class="nav-container" style="margin-top: 15px;">
                    <button class="btn btn-back" onclick="showSection('section-home')">‚¨Ö Dashboard</button>
                    <button class="btn btn-green" onclick="showSection('section-clues-wide')">Clues ‚û°</button>
                </div>
            </div>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-clues-wide" class="game-section">
        <h2>THE CRIME SCENE</h2>
        <p style="text-align: center; margin-bottom: 5px;">What does not belong here?</p>
        <img id="img-crime-scene" src="scene_witch.png" alt="Wide Crime Scene" class="scene-image" style="max-height: 70vh;">
        
        <div class="nav-container">
            <button class="btn btn-back" onclick="showSection('section-home')">‚¨Ö Dashboard</button>
            <button class="btn btn-blue" onclick="showSection('section-vocab')">Start Training üß†</button>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-vocab" class="game-section">
        <h2>AGENT TRAINING: VOCABULARY</h2>
        <div id="quiz-container">
            </div>
        <div class="nav-container">
             <button class="btn btn-back" onclick="showSection('section-clues-wide')">‚¨Ö Back</button>
             <button id="btn-go-lab" class="btn btn-disabled" disabled onclick="showSection('section-clues-close')">üîí Go to Lab</button>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-clues-close" class="game-section">
        <div class="split-layout">
            <div class="split-left">
                <img id="img-evidence" src="clues_witch.png" alt="Evidence Scanning" class="scene-image">
            </div>
            <div class="split-right">
                <h2 style="margin-bottom: 10px;">DECRYPT EVIDENCE</h2>
                <div class="profiles-stack" id="clues-stack">
                    <div class="profile-card">
                        <h3 id="clueA-title">Clue A</h3>
                        <div class="scramble-area" id="scramble-A"></div>
                    </div>
                    <div class="profile-card">
                        <h3 id="clueB-title">Clue B</h3>
                        <div class="scramble-area" id="scramble-B"></div>
                    </div>
                    <div class="profile-card">
                        <h3 id="clueC-title">Clue C</h3>
                        <div class="scramble-area" id="scramble-C"></div>
                    </div>
                </div>
                <div class="nav-container" style="margin-top: 15px;">
                    <button class="btn btn-back" onclick="showSection('section-vocab')">‚¨Ö Vocab</button>
                    <button class="btn btn-green" onclick="showSection('section-interrogation')">Interrogate Witness üó£Ô∏è</button>
                </div>
            </div>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-interrogation" class="game-section">
        <h2>INTERROGATION ROOM</h2>
        <p style="text-align: center;">Three elves saw something. <strong>Only one statement matches your evidence.</strong><br>Select the matching statement to unlock the solution.</p>
        
        <div id="witness-container" style="display: flex; flex-direction: column; width: 100%; max-width: 800px;">
            </div>

        <div class="nav-container">
            <button class="btn btn-back" onclick="showSection('section-clues-close')">‚¨Ö Evidence</button>
            <button id="btn-go-solve" class="btn btn-disabled" disabled onclick="showSection('section-solve')">üîí Solve Case</button>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-solve" class="game-section">
        <h2>FINAL REPORT</h2>
        <p>Based on the evidence and witness statements, who is guilty?</p>
        <div class="solve-options">
            <div class="solve-btn" onclick="checkAnswer('witch')">
                <h3>The Witch</h3>
            </div>
            <div class="solve-btn" onclick="checkAnswer('skeleton')">
                <h3>The Skeleton</h3>
            </div>
            <div class="solve-btn" onclick="checkAnswer('ghost')">
                <h3>The Ghost</h3>
            </div>
        </div>
        <div class="nav-container">
            <button class="btn btn-back" onclick="showSection('section-interrogation')">‚¨Ö Review Witness</button>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>


    <div id="section-final" class="game-section">
        <div class="split-layout">
            <div class="split-left">
                <img id="img-final" src="final_witch.png" alt="Success" class="scene-image">
            </div>
            <div class="split-right">
                <div style="background: #2ecc71; padding: 15px; border-radius: 12px; color: #2c3e50; width: 90%; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                    <h2 style="color: #fff; margin-top:0; font-size: 1.4rem;">CONGRATULATIONS!</h2>
                    <p style="font-size: 1.2rem; font-weight: bold; margin: 10px 0;" id="final-culprit-name">It was X!</p>
                    <p style="font-size: 1rem; margin-bottom: 0;" id="final-conclusion">Conclusion text.</p>
                </div>
                <div class="nav-container" style="margin-top: 15px;">
                    <button class="btn btn-blue" onclick="location.reload();">Play New Game üîÑ</button>
                </div>
            </div>
        </div>
        <div class="footer">Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved</div>
    </div>

</div>

<script>
    // --- TIMER LOGIC ---
    let timeLeft = 900; // 15 minutes
    setInterval(function() {
        if(timeLeft > 0) {
            timeLeft--;
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            document.getElementById('mission-timer').innerText = 
                (minutes < 10 ? "0" : "") + minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
        } else {
            // Optional: Auto-fail logic here
        }
    }, 1000);

    // --- GAME DATA ---
    const gameScenarios = {
        witch: {
            culpritId: 'witch',
            culpritName: "It was the Witch!",
            quiz: [
                { word: "STICKY", opts: ["Like glue", "Dry like sand"], ans: 0 },
                { word: "MESSY", opts: ["Dirty/Untidy", "Clean"], ans: 0 },
                { word: "POT", opts: ["For cooking", "For writing"], ans: 0 },
                { word: "CAULDRON", opts: ["Big pot", "Small cup"], ans: 0 }
            ],
            clues: [
                { title: "The Pot", text: "This heavy pot smells like green soup." },
                { title: "The Spill", text: "Sticky green slime is on the rug." },
                { title: "The Hat", text: "A black hat is under the table." }
            ],
            witness: [
                { text: "I slipped on a green puddle near the fireplace.", correct: true }, // MATCHES
                { text: "I saw lights flickering and breaking.", correct: false },
                { text: "I heard drumming sounds from the corner.", correct: false }
            ],
            conclusion: "She was messy with her green soup, and her heavy pot was too heavy for the Ghost. You saved Christmas!"
        },
        skeleton: {
            culpritId: 'skeleton',
            culpritName: "It was the Skeleton!",
            quiz: [
                { word: "RIB", opts: ["Chest bone", "Candy"], ans: 0 },
                { word: "WRAPPING", opts: ["Paper cover", "Window"], ans: 0 },
                { word: "TIDY", opts: ["Clean", "Messy"], ans: 0 }
            ],
            clues: [
                { title: "Dry Bone", text: "A small dry rib bone is near the fire." },
                { title: "Wrapping", text: "The paper is folded very tidily." },
                { title: "Music", text: "Notes for bone drums are on the chair." }
            ],
            witness: [
                { text: "I found sheet music for drums on the chair.", correct: true }, // MATCHES
                { text: "The room was freezing cold and icy.", correct: false },
                { text: "There was a terrible smell of old soup.", correct: false }
            ],
            conclusion: "He left a rib bone behind, and the room was too tidy for the Witch! He wanted to play drums on Santa's sleigh."
        },
        ghost: {
            culpritId: 'ghost',
            culpritName: "It was the Ghost!",
            quiz: [
                { word: "SLIME", opts: ["Wet liquid", "Hard rock"], ans: 0 },
                { word: "ECTOPLASM", opts: ["Ghost goo", "Toothpaste"], ans: 0 },
                { word: "PATCH", opts: ["Small spot", "Mountain"], ans: 0 },
                { word: "RUG", opts: ["Floor carpet", "Curtain"], ans: 0 },
                { word: "SMASHED", opts: ["Broken", "Fixed"], ans: 0 },
                { word: "DEDUCTION", opts: ["Logic", "Guessing"], ans: 0 },
                { word: "TRANSPARENT", opts: ["See-through", "Solid"], ans: 0 }
            ],
            clues: [
                { title: "Broken Lights", text: "The tree lights have been smashed." },
                { title: "Freezing", text: "There is an icy patch on the rug." },
                { title: "Ectoplasm", text: "Transparent slime is on the wall." }
            ],
            witness: [
                { text: "It suddenly became very cold and icy.", correct: true }, // MATCHES
                { text: "I saw someone folding paper neatly.", correct: false },
                { text: "I saw a heavy iron pot on the floor.", correct: false }
            ],
            conclusion: "He smashed the bright lights and left freezing cold spots everywhere because the festive cheer was too bright!"
        }
    };

    let currentScenario = null;
    let quizScore = 0;
    let totalQuiz = 0;

    function initGame() {
        const keys = Object.keys(gameScenarios);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        currentScenario = gameScenarios[randomKey];
        
        console.log("Game initialized with culprit: " + currentScenario.culpritId);

        // 1. SWAP IMAGES
        document.getElementById('img-crime-scene').src = 'scene_' + currentScenario.culpritId + '.png';
        document.getElementById('img-evidence').src = 'clues_' + currentScenario.culpritId + '.png';
        document.getElementById('img-final').src = 'final_' + currentScenario.culpritId + '.png';

        // 2. BUILD QUIZ
        const quizContainer = document.getElementById('quiz-container');
        quizContainer.innerHTML = ''; 
        totalQuiz = currentScenario.quiz.length;
        quizScore = 0;
        
        currentScenario.quiz.forEach((qData, index) => {
            const card = createQuizCard(qData, index);
            quizContainer.appendChild(card);
        });

        // 3. BUILD DECRYPTOR
        setupScramble('scramble-A', currentScenario.clues[0].text);
        setupScramble('scramble-B', currentScenario.clues[1].text);
        setupScramble('scramble-C', currentScenario.clues[2].text);
        document.getElementById('clueA-title').innerText = currentScenario.clues[0].title;
        document.getElementById('clueB-title').innerText = currentScenario.clues[1].title;
        document.getElementById('clueC-title').innerText = currentScenario.clues[2].title;

        // 4. BUILD INTERROGATION ROOM
        const witnessContainer = document.getElementById('witness-container');
        witnessContainer.innerHTML = '';
        // Shuffle witnesses
        const witnesses = [...currentScenario.witness].sort(() => Math.random() - 0.5);
        
        witnesses.forEach((w, index) => {
            const div = document.createElement('div');
            div.className = 'witness-card';
            div.innerHTML = `<span class="elf-avatar">üßù</span> <strong>Elf Witness #${index+1}:</strong> "${w.text}"`;
            div.onclick = function() { checkWitness(this, w.correct); };
            witnessContainer.appendChild(div);
        });
    }

    // --- QUIZ LOGIC ---
    function createQuizCard(data, index) {
        const div = document.createElement('div');
        div.className = 'quiz-card';
        div.innerHTML = `<div class="quiz-word">${data.word}</div>`;
        const optionsDiv = document.createElement('div');
        optionsDiv.className = 'quiz-options';
        const btn1 = document.createElement('button');
        const btn2 = document.createElement('button');
        btn1.className = 'quiz-btn'; btn2.className = 'quiz-btn';

        if (Math.random() > 0.5) {
            btn1.innerText = data.opts[1]; btn2.innerText = data.opts[0]; 
            btn1.onclick = function() { checkVocab(this, false); };
            btn2.onclick = function() { checkVocab(this, true); };
        } else {
            btn1.innerText = data.opts[0]; btn2.innerText = data.opts[1];
            btn1.onclick = function() { checkVocab(this, true); };
            btn2.onclick = function() { checkVocab(this, false); };
        }
        optionsDiv.appendChild(btn1); optionsDiv.appendChild(btn2);
        div.appendChild(optionsDiv);
        return div;
    }

    function checkVocab(btn, isCorrect) {
        if(btn.classList.contains('correct') || btn.classList.contains('wrong')) return; 
        const parent = btn.parentElement;
        const buttons = parent.getElementsByClassName('quiz-btn');
        for(let b of buttons) b.disabled = true;

        if (isCorrect) {
            btn.classList.add('correct');
            quizScore++;
        } else {
            btn.classList.add('wrong');
        }
        if(quizScore === totalQuiz) {
            const goBtn = document.getElementById('btn-go-lab');
            goBtn.classList.remove('btn-disabled');
            goBtn.classList.add('btn-green');
            goBtn.disabled = false;
            goBtn.innerText = "üîì Access Granted";
        }
    }

    // --- DECRYPTOR LOGIC ---
    function setupScramble(elementId, sentence) {
        const container = document.getElementById(elementId);
        container.innerHTML = ""; 
        const words = sentence.split(" ");
        const shuffled = [...words].sort(() => Math.random() - 0.5);
        const bankDiv = document.createElement('div'); bankDiv.className = 'word-bank';
        const answerDiv = document.createElement('div'); answerDiv.className = 'answer-box';

        shuffled.forEach(word => {
            const span = document.createElement('span');
            span.className = 'scramble-word';
            span.innerText = word;
            span.onclick = function() {
                if(this.parentElement === bankDiv) answerDiv.appendChild(this);
                else bankDiv.appendChild(this);
                checkSentence(answerDiv, sentence, container);
            };
            bankDiv.appendChild(span);
        });
        container.appendChild(bankDiv); container.appendChild(answerDiv);
    }

    function checkSentence(answerDiv, originalSentence, container) {
        const currentWords = Array.from(answerDiv.children).map(span => span.innerText);
        if (currentWords.join(" ") === originalSentence) {
            container.innerHTML = `<div class='decrypted-text'>evidence decrypted:<br>"${originalSentence}"</div>`;
        }
    }

    // --- INTERROGATION LOGIC ---
    function checkWitness(card, isCorrect) {
        // Reset siblings
        const siblings = document.querySelectorAll('.witness-card');
        siblings.forEach(s => s.classList.remove('selected', 'correct', 'wrong'));
        
        card.classList.add('selected');

        if(isCorrect) {
            card.classList.add('correct');
            const btn = document.getElementById('btn-go-solve');
            btn.classList.remove('btn-disabled');
            btn.classList.add('btn-red');
            btn.disabled = false;
            btn.innerText = "üîì Solve Case";
        } else {
            card.classList.add('wrong');
            alert("This statement contradicts the evidence! Try again.");
            timeLeft -= 60; // 1 min penalty
        }
    }

    function checkAnswer(selectedSuspect) {
        if (selectedSuspect === currentScenario.culpritId) {
            var audio = new Audio('audio.mp3');
            audio.play().catch(e => console.log("Audio play failed: " + e));
            document.getElementById('final-culprit-name').innerText = currentScenario.culpritName;
            document.getElementById('final-conclusion').innerText = currentScenario.conclusion;
            showSection('section-final');
        } else {
            alert("Incorrect! Review the decrypted evidence.");
            timeLeft -= 30; 
        }
    }

    function showSection(sectionId) {
        const sections = document.querySelectorAll('.game-section');
        const logo = document.getElementById('app-logo');
        sections.forEach(section => { section.style.display = 'none'; });
        document.getElementById(sectionId).style.display = 'flex';
        
        if (sectionId === 'section-vocab') {
            logo.style.display = 'none';
        } else {
            logo.style.display = 'block';
        }
    }
</script>

</body>
</html>